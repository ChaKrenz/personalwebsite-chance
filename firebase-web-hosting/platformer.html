<!DOCTYPE html>
<html>
<head>
    <title>Gadget Runner Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #1a1a1a;
        }

        #game-container {
            width: 1200px;
            height: 800px;
            position: relative;
            margin: 0 auto;
            background: #1a1a1a;
        }

        .player {
            width: 30px;
            height: 30px;
            background: #4CAF50;
            position: absolute;
            border-radius: 5px;
            transition: opacity 0.15s ease-in-out;
        }

        .player::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: #2E7D32;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            transition: left right 0.2s ease;
        }

        .player.facing-right::after {
            right: 2px;
        }

        .player.facing-left::after {
            left: 2px;
        }

        .platform {
            position: absolute;
            background: #666;
            border-radius: 3px;
        }

        .lava {
            position: absolute;
            background: #ff4444;
            border-radius: 3px;
        }

        .goal {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .tutorial-sign {
            position: absolute;
            background: none;
            color: #333333;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            pointer-events: none;
            z-index: 1000;
            font-size: 32px;
            text-align: center;
            width: 100%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        #hud {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-family: monospace;
            z-index: 1000;
        }

        #level-display {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-family: monospace;
            font-size: 24px;
            z-index: 1000;
        }

        #controls {
            position: fixed;
            top: 10px;
            right: 10px;
            color: white;
            font-family: monospace;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 5px;
            z-index: 1000;
        }

        .controls-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .control-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .key {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            border: 1px solid #666;
        }

        @keyframes dash {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .dashing {
            animation: dash 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- Rest of the HTML remains the same until the createLevel function -->
    <div id="game-container">
        <div id="level-display">Level 1</div>
        <div id="hud">
        </div>

        <div id="controls">
            <div class="controls-title">CONTROLS</div>
            <div class="control-item">
                <span class="key">←</span>
                <span>Move Left</span>
            </div>
            <div class="control-item">
                <span class="key">→</span>
                <span>Move Right</span>
            </div>
            <div class="control-item">
                <span class="key">↑</span>
                <span>Jump/Double Jump</span>
            </div>
            <div class="control-item">
                <span class="key">C</span>
                <span>Dash</span>
            </div>
        </div>
    </div>

    <script>
        const GRAVITY = 0.5;
        const JUMP_FORCE = 12;
        const MOVE_SPEED = 5;
        const DASH_DISTANCE = 200;

        // Replace the global variables related to dash
        let isDashing = false;
        let dashStartX = 0;
        let dashTargetX = 0;
        let dashProgress = 0;
        // Remove the duplicate declaration of 'canDash'
        const DASH_DURATION = 10;

        let currentLevel = 1;
        let dashCooldown = 0;
        let canDash = true;
        let spawnPoint = { x: 100, y: 100 };
        let canDoubleJump = true;
        let tutorialSigns = [];

        const keys = {
            left: false,
            right: false,
            up: false
        };

        class GameObject {
            constructor(x, y, width, height, className) {
                this.position = { x, y };
                this.velocity = { x: 0, y: 0 };
                this.width = width;
                this.height = height;
                this.facingRight = true;

                this.element = document.createElement('div');
                this.element.className = className;
                this.element.style.width = `${width}px`;
                this.element.style.height = `${height}px`;
                
                if (className === 'player') {
                    this.element.classList.add('facing-right');
                }
                
                document.getElementById('game-container').appendChild(this.element);
                this.updatePosition();
            }

            updatePosition() {
                this.element.style.left = `${this.position.x}px`;
                this.element.style.top = `${this.position.y}px`;
            }

            setDirection(facingRight) {
                if (this.facingRight !== facingRight) {
                    this.facingRight = facingRight;
                    this.element.classList.remove('facing-right', 'facing-left');
                    this.element.classList.add(facingRight ? 'facing-right' : 'facing-left');
                }
            }

            remove() {
                this.element.remove();
            }

            intersects(other) {
                return this.position.x < other.position.x + other.width &&
                       this.position.x + this.width > other.position.x &&
                       this.position.y < other.position.y + other.height &&
                       this.position.y + this.height > other.position.y;
            }
        }

        function createTutorialSign(x, y, text) {
            const sign = document.createElement('div');
            sign.className = 'tutorial-sign';
            sign.textContent = text;
            sign.style.left = `${x}px`;
            sign.style.top = `${y}px`;
            sign.style.fontSize = '60px';
            document.getElementById('game-container').appendChild(sign);
            tutorialSigns.push(sign);
        }

        const player = new GameObject(100, 100, 30, 30, 'player');
        let isOnGround = false;
        let platforms = [];
        let lavaBlocks = [];
        let goal = null;

        function createLevel(levelNumber) {
            // Clear existing level
            platforms.forEach(p => p.remove());
            lavaBlocks.forEach(l => l.remove());
            if (goal) goal.remove();
            tutorialSigns.forEach(sign => sign.remove());
            tutorialSigns = [];

            platforms = [];
            lavaBlocks = [];

            // Reset player states
            canDoubleJump = true;
            canDash = true;

            switch(levelNumber) {
                case 1:
                    spawnPoint = { x: 50, y: 700 };
                    platforms = [
                        new GameObject(0, 750, 1200, 20, 'platform')
                    ];
                    goal = new GameObject(1100, 700, 30, 30, 'goal');
                    createTutorialSign(600, 400, "Use ← → to move");
                    createTutorialSign(600, 450, "Press ↑ to jump");
                    createTutorialSign(600, 500, "Reach the green circle!");
                    break;

                case 2:
                    spawnPoint = { x: 50, y: 700 };
                    platforms = [
                        new GameObject(0, 750, 400, 20, 'platform'),
                        new GameObject(600, 750, 600, 20, 'platform')
                    ];
                    lavaBlocks = [
                        new GameObject(400, 750, 200, 20, 'lava')
                    ];
                    goal = new GameObject(1100, 700, 30, 30, 'goal');
                    createTutorialSign(600, 400, "Avoid the red lava!");
                    break;

                case 3:
                    spawnPoint = { x: 50, y: 700 };
                    platforms = [
                        new GameObject(0, 750, 300, 20, 'platform'),
                        new GameObject(500, 750, 300, 20, 'platform'),
                        new GameObject(900, 750, 300, 20, 'platform')
                    ];
                    lavaBlocks = [
                        new GameObject(300, 750, 200, 20, 'lava'),
                        new GameObject(800, 750, 100, 20, 'lava')
                    ];
                    goal = new GameObject(1100, 700, 30, 30, 'goal');
                    createTutorialSign(600, 400, "Press C to dash!");
                    break;

                case 4:
                    spawnPoint = { x: 50, y: 700 };
                    platforms = [
                        new GameObject(0, 750, 400, 20, 'platform'),
                        new GameObject(800, 750, 400, 20, 'platform')
                    ];
                    lavaBlocks = [
                        new GameObject(400, 750, 400, 20, 'lava')
                    ];
                    goal = new GameObject(1100, 700, 30, 30, 'goal');
                    createTutorialSign(600, 400, "Press ↑ twice for double jump!");
                    break;

                case 5:
                    spawnPoint = { x: 50, y: 700 };
                    platforms = [
                        new GameObject(0, 750, 200, 20, 'platform'),
                        new GameObject(400, 600, 200, 20, 'platform'),
                        new GameObject(100, 400, 200, 20, 'platform'),
                        new GameObject(700, 200, 200, 20, 'platform')
                    ];
                    lavaBlocks = [
                        new GameObject(0, 750, 1200, 20, 'lava')
                    ];
                    platforms[0].element.style.zIndex = "1";
                    goal = new GameObject(1100, 150, 30, 30, 'goal');
                    break;

                case 6:
                    spawnPoint = { x: 50, y: 700 };
                    platforms = [
                        new GameObject(0, 750, 200, 20, 'platform'),
                        new GameObject(300, 750, 200, 20, 'platform'),
                        new GameObject(600, 750, 200, 20, 'platform'),
                        new GameObject(900, 750, 200, 20, 'platform'),
                        new GameObject(300, 600, 200, 20, 'platform'),
                        new GameObject(700, 400, 200, 20, 'platform')
                    ];
                    lavaBlocks = [
                        new GameObject(200, 750, 100, 20, 'lava'),
                        new GameObject(500, 750, 100, 20, 'lava'),
                        new GameObject(800, 750, 100, 20, 'lava'),
                        new GameObject(1100, 750, 100, 20, 'lava')
                    ];
                    goal = new GameObject(1100, 350, 30, 30, 'goal');
                    break;

                case 7:
                    spawnPoint = { x: 50, y: 700 };
                    platforms = [
                        new GameObject(0, 750, 150, 20, 'platform'),
                        new GameObject(250, 650, 150, 20, 'platform'),
                        new GameObject(500, 500, 150, 20, 'platform'),
                        new GameObject(700, 450, 300, 20, 'platform'),
                        new GameObject(750, 300, 150, 20, 'platform'),
                        new GameObject(1000, 200, 150, 20, 'platform')
                    ];
                    lavaBlocks = [
                        new GameObject(0, 750, 1200, 20, 'lava'),
                        new GameObject(400, 600, 500, 20, 'lava'),
                        new GameObject(200, 350, 700, 20, 'lava')
                    ];
                    platforms[0].element.style.zIndex = "1";
                    goal = new GameObject(1100, 150, 30, 30, 'goal');
                    createTutorialSign(600, 200, "Final challenge!");
                    break;
            }

            document.getElementById('level-display').textContent = `Level ${levelNumber}`;
            player.position = { ...spawnPoint };
        }

        // Update the dash function to remove cooldown logic
function dash() {
    if (!canDash || isDashing) return;
    
    dashStartX = player.position.x;
    const direction = player.facingRight ? 1 : -1;
    dashTargetX = dashStartX + (DASH_DISTANCE * direction);
    
    isDashing = true;
    dashProgress = 0;
    player.element.classList.add('dashing');
    canDash = false;  // Will be reset when touching ground
}

        function updateDashUI() {
            const dashBar = document.getElementById('dashCooldown');
            dashBar.style.width = `${((DASH_COOLDOWN - dashCooldown) / DASH_COOLDOWN) * 100}%`;
        }

        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                    keys.left = true;
                    break;
                case 'ArrowRight':
                    keys.right = true;
                    break;
                case 'ArrowUp':
                    if (isOnGround) {
                        player.velocity.y = -JUMP_FORCE;
                        canDoubleJump = true;
                    } else if (canDoubleJump) {
                        player.velocity.y = -JUMP_FORCE;
                        canDoubleJump = false;
                    }
                    keys.up = true;
                    break;
                case 'c':
                    if (canDash) {
                        dash();
                    }
                    break;
            }
        });

        document.addEventListener('keyup', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                    keys.left = false;
                    break;
                case 'ArrowRight':
                    keys.right = false;
                    break;
                case 'ArrowUp':
                    keys.up = false;
                    break;
            }
        });

        function checkCollisions() {
            isOnGround = false;
            for (const platform of platforms) {
                if (player.intersects(platform)) {
                    if (player.velocity.y > 0 && 
                        player.position.y + player.height - player.velocity.y <= platform.position.y) {
                        player.position.y = platform.position.y - player.height;
                        player.velocity.y = 0;
                        isOnGround = true;
                        canDoubleJump = true;
                        canDash = true;  // Reset dash when touching ground
                    } else if (player.velocity.y < 0 && 
                            player.position.y - player.velocity.y >= platform.position.y + platform.height) {
                        player.position.y = platform.position.y + platform.height;
                        player.velocity.y = 0;
                    }
                    else if (player.velocity.x > 0 || (isDashing && dashTargetX > dashStartX)) {
                        player.position.x = platform.position.x - player.width;
                        if (isDashing) {
                            isDashing = false;
                            player.element.classList.remove('dashing');
                        }
                        player.velocity.x = 0;
                    } else if (player.velocity.x < 0 || (isDashing && dashTargetX < dashStartX)) {
                        player.position.x = platform.position.x + platform.width;
                        if (isDashing) {
                            isDashing = false;
                            player.element.classList.remove('dashing');
                        }
                        player.velocity.x = 0;
                    }
                }
                if (goal && player.intersects(goal)) {
                completeLevel();
                }
            }

            // Update the lava collision to reset dash ability
            for (const lava of lavaBlocks) {
                if (player.intersects(lava)) {
                    player.position = { ...spawnPoint };
                    player.velocity = { x: 0, y: 0 };
                    canDoubleJump = true;
                    canDash = true;  // Reset dash when hitting lava
                    break;
                }
            }

            if (goal && player.intersects(goal)) {
                if (currentLevel < 7) {
                    currentLevel++;
                    createLevel(currentLevel);
                } else {
                    alert('Congratulations! You beat all levels!');
                    currentLevel = 1;
                    createLevel(currentLevel);
                }
            }
        }

        async function completeLevel() {
            if (currentLevel < 7) {
                currentLevel++;
                await new Promise(resolve => setTimeout(resolve, 1000));
                createLevel(currentLevel);
            } else {
                alert('Congratulations! You beat all levels!');
                currentLevel = 1;
                await new Promise(resolve => setTimeout(resolve, 1000));
                createLevel(currentLevel);
            }
        }

        function gameLoop() {
            if (isDashing) {
                dashProgress++;
                
                const t = dashProgress / DASH_DURATION;
                const easeOut = 1 - Math.pow(1 - t, 2);
                player.position.x = dashStartX + (dashTargetX - dashStartX) * easeOut;
                
                if (dashProgress >= DASH_DURATION) {
                    isDashing = false;
                    player.element.classList.remove('dashing');
                }
            } 
            else if (keys.left) {
                player.velocity.x = -MOVE_SPEED;
                player.setDirection(false);
            } else if (keys.right) {
                player.velocity.x = MOVE_SPEED;
                player.setDirection(true);
            } else {
                player.velocity.x = 0;
            }

            player.velocity.y += GRAVITY;

            if (!isDashing) {
                player.position.x += player.velocity.x;
            }
            player.position.y += player.velocity.y;

            checkCollisions();

            const container = document.getElementById('game-container');
            if (player.position.x < 0) {
                player.position.x = 0;
                if (isDashing) {
                    isDashing = false;
                    player.element.classList.remove('dashing');
                }
            }
            if (player.position.x + player.width > container.clientWidth) {
                player.position.x = container.clientWidth - player.width;
                if (isDashing) {
                    isDashing = false;
                    player.element.classList.remove('dashing');
                }
            }
            if (player.position.y < 0) player.position.y = 0;
            if (player.position.y + player.height > container.clientHeight) {
                player.position.y = container.clientHeight - player.height;
                player.velocity.y = 0;
                isOnGround = true;
                canDoubleJump = true;
                canDash = true;  // Reset dash when hitting the floor
            }

            player.updatePosition();
            requestAnimationFrame(gameLoop);
        }

        createLevel(currentLevel);
        gameLoop();
        updateDashUI();
    </script>
</body>
</html>